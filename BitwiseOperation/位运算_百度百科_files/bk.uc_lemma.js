if(typeof bk=="undefined"){bk={};}if(typeof bk.ui=="undefined"){bk.ui={};}bk.ui.enctip=function(){this.type=1;this.msg_url="/user/ajax/checknotice?entry="+this.type+"&r="+Math.random();this.has_login=true;this.id="encourage_tip_wrapper";this.cookie_name="bk_encourage_tip2";this.cookie_interval=1800000;};bk.ui.enctip.prototype={render:function(B){var C=document.createDocumentFragment(),A=document.createElement("div");A.id=this.id;A.className="enc-tip";A.innerHTML='<div class="ctr"><div class="tri out"></div><div class="tri in"></div></div><div class="enc-wrap"><div class="enc-content fix clearfix"><div class="fl"><a href="'+B.href+'" target="_blank" onclick="nslog(\''+window.location.href+'\', 434)"><img id="encTipIcon" src="" /></a></div><div class="fr"><h3><a href="'+B.href+'" target="_blank" onclick="nslog(\''+window.location.href+"', 434)\">"+B.title+'</a></h3><div class="enc-txt" id="encourage_body">'+B.text+'</div></div></div></div><a href="javascript:void(0)" class="close" title="\u5173\u95ed" onclick="var tipWrapper = baidu.g(\'encourage_tip_wrapper\');tipWrapper.parentNode.removeChild(tipWrapper);nslog(\''+window.location.href+"',442);\">\u5173\u95ed</a>";C.appendChild(A);document.body.appendChild(C);var _=baidu.g("encTipIcon");_.onload=function(){var C=baidu.browser.ie?262:264,B=baidu.dom.query(".enc-content .fl")[0].offsetWidth;baidu.dom.setStyle(baidu.dom.query(".enc-content .fr")[0],"width",(C-B));baidu.q("enc-content")[0].style.zoom="1";baidu.q("enc-tip")[0].style.visibility="visible";_.onload=null;var D=baidu.dom.getPosition("my_home_container").left,F=baidu.dom.getPosition(A.id).left,E=D-F+20;baidu.q("ctr")[0].style.left=E+"px";};_.src=B.url;bk.ui.enctip.set_nslog_area_type("encourage_body",435);},close:function(){var _=baidu.g("encourage_tip_wrapper");if(_){_.parentNode.removeChild(_);}},init:function(){var A=false;if(this.has_login){var _=baidu.cookie.get(this.cookie_name);if(!_){A=true;baidu.cookie.set(this.cookie_name,baidu.url.jsonToQuery({show:A}),{expires:this.cookie_interval});}}if(A){this.get_content();}},get_content:function(){var _=this;baidu.ajax.get(this.msg_url,function(D){var A=bk.ui.enctip.format_result(baidu.json.parse(D.responseText),_.type),B=false;for(var C in A){B=true;break;}if(B){_.render(A);}});}};bk.ui.enctip.format_result=function(A,_){var C={},B=A.length;if(B==0){return C;}switch(_){case 0:case 1:C.href=A[0].iconHref;C.url=A[0].iconUrl;C.title=A[0].title;C.text=A[0].text;return C;break;case 2:C.href=A[0].iconHref;C.url=A[0].iconUrl;C.banner_href=A[0].bannerHref;C.banner_url=A[0].bannerBigUrl;C.title=A[0].title;C.text=[];break;case 3:C.href=A[0].iconHref;C.title=A[0].title;C.text=[];break;case 4:C.banner_href=A[0].bannerHref;C.banner_url=A[0].bannerUrl;C.text=A[0].text;return C;break;}if(B>0){for(var D=0;D<B;++D){C.text.push(A[D].text);}}return C;};bk.ui.enctip.build_tip_generic=function(_,A){var D=function(_){return A.call(null,_);},B=_,C="/user/ajax/checknotice?entry="+B+"&r="+Math.random();baidu.ajax.get(C,function(C){var A=baidu.json.parse(C.responseText);if(A.length>0){var _=bk.ui.enctip.format_result(A,B);D(_);}});};bk.ui.enctip.set_nslog_area_type=function(A,B){var _=(typeof A==="string")?baidu.g(A):A;baidu.each(_.getElementsByTagName("a"),function(_){_.target="_blank";_.className="nslog:"+B;});};bk.ui.enctip.build_edit_tip=function(){var _=function(_){var A='<div id="encourage_tipbar"><div class="push-close-btn" alt="\u5173\u95ed" title="\u5173\u95ed"  onclick="nslog(\''+window.location.href+'\', 443);var msg_pb = document.getElementById(\'encourage_tipbar\');msg_pb.parentNode.removeChild(msg_pb);msg_pb=null"></div><div><a class="icon-address" id="encourage_icon_href" href="'+_.href+'" target="_blank"><img id="encourage_icon_url" src="'+_.url+'" alt="\u6253\u5f00\u94fe\u63a5" title="\u6253\u5f00\u94fe\u63a5"  /></a><span id="encourage_text">'+_.text+"</span></div></div>";if(baidu.g("inputShowMainInfoBoxDiv")){baidu.dom.insertHTML("inputShowMainInfoBoxDiv","afterEnd",A);bk.ui.enctip.set_nslog_area_type("encourage_text",436);}};bk.ui.enctip.build_tip_generic(0,_);};bk.ui.enctip.build_usercenter_tip=function(){var _=function(A){var C=A.text.length,_=[];for(var E=0;E<C;++E){_.push("<li><span>");_.push(A.text[E]);_.push("</span></li>");}var D=window.location.href,B='<div class="push-ads" id="push_ads"><a id="banner_href" href="'+A.banner_href+'" class="icon-address" target="_blank" onclick="nslog(\''+A.banner_href+'\',437)"><img id="banner_url" src="'+A.banner_url+'" alt="\u6253\u5f00\u94fe\u63a5" title="\u6253\u5f00\u94fe\u63a5" width="778px" height="100px"/></a><a class="del" onclick="nslog(\''+D+'\', 444);var del = document.getElementById(\'push_ads\');del.parentNode.removeChild(del);del=null"><img src="http://img.baidu.com/img/baike/encourage/push-del.gif" alt="\u5173\u95ed" title="\u5173\u95ed" /></a></div><dl class="mod-push" id="enc_push_bar"><dt><p><a id="encourage_icon_href" href="'+A.href+'" class="icon-address" target="_blank"><img id="encourage_icon_url" src="'+A.url+'" alt="\u6253\u5f00\u94fe\u63a5" title="\u6253\u5f00\u94fe\u63a5" /></a><span id="encourage_title">'+A.title+'</span></p><div class="del" onclick="nslog(\''+D+'\', 445);var del = document.getElementById(\'enc_push_bar\');del.parentNode.removeChild(del);del=null" title="\u5173\u95ed"></div></dt><dd><ul id="encouragements">'+_.join("")+"</ul></dd></dl>";baidu.dom.insertHTML("col_main","afterBegin",B);bk.ui.enctip.set_nslog_area_type("encouragements",438);};bk.ui.enctip.build_tip_generic(2,_);};bk.ui.enctip.build_userinfo_tip=function(){var A=baidu.g("encourage");if(!A){return;}var _=function(D){baidu.g("encourage_icon_href").href=D.href;var C=baidu.g("encourage_title");C.href=D.href;C.innerHTML=D.title;var E=D.text.length,B=[];for(var F=0;F<E;++F){B.push("<li><span>");B.push(D.text[F]);B.push("</span></li>");}var _=baidu.g("encouragements");_.innerHTML=B.join("");baidu.removeClass(A,"dnone");baidu.removeClass(A.parentNode,"dnone");bk.ui.enctip.set_nslog_area_type(_,439);};bk.ui.enctip.build_tip_generic(3,_);};bk.ui.enctip.build_edit_success_tip=function(_){var A=function(_){var A='<a href="'+_.banner_href+'" onclick="nslog(\''+_.banner_href+'\',440)" target="_blank"><img width="450px" height="60px" src="'+_.banner_url+'" /></a>',C=baidu.g("encourage_tip");C.innerHTML=A;C.style.display="block";var B=baidu.g("encourage_text");B.innerHTML=_.text;B.style.display="block";};bk.ui.enctip.build_tip_generic(4,A);};baidu.more.ns("bk.usercenter");bk.usercenter.progressbar=function(_){this.options=_||{};};baidu.extend(bk.usercenter.progressbar.prototype,{build:function(){baidu.g(this.options.selector).innerHTML=this.html();},init:function(_){if(_){this.options=baidu.extend(this.options||{},_);}this.build();},html:function(){var _=[];_.push('<div class="progress-bar">');_.push('<div class="process-inner fix"><span class="pl"></span>');var A=this.calculateProgress();if(A>0){_.push('<span class="pb" style="width:'+A+'px"></span>');}_.push('<span class="pr"></span></div>');_.push('<div class="process-text" style="'+(this.options.textStyle||"")+'">'+this.options.text+"</div>");_.push("</div>");return _.join("");},calculateProgress:function(){var A=this.options.maxWidth,B=A/100,_=(this.options.process||0)*100*B;_=(_>A?A:_);this.options.pixelProgress=_;return _;}});bk.usercenter.commonTaskProgressbar=function(_){bk.usercenter.progressbar.call(this,_);baidu.extend(this.options,{txtStart:-16});};baidu.lang.inherits(bk.usercenter.commonTaskProgressbar,bk.usercenter.progressbar);baidu.extend(bk.usercenter.commonTaskProgressbar.prototype,{init:function(){bk.usercenter.progressbar.prototype.init.call(this);var _=this.options.pixelProgress+this.options.txtStart,A=baidu.dom.q("process-text",this.options.selector,"div")[0];if(A){A.style.left=_+"px";}}});baidu.extend(bk.usercenter.progressbar,{init:function(C){var B=C.type.toLowerCase()||"simple",_=bk.usercenter.progressbar.barConfigs[B];C.maxWidth=_.maxWidth;var A=new _.ctr(C);A.init();},barConfigs:{simple:{ctr:bk.usercenter.progressbar,maxWidth:120},common:{ctr:bk.usercenter.commonTaskProgressbar,maxWidth:140}}});baidu.more.ns("bk.floatBottle");(function(){bk.floatBottle.bottle=function(_){baidu.extend(this,_);this.refuse=null;this.replyList=[];};baidu.extend(bk.floatBottle,{BOTTLE_TYPE:{CARD:1,SUMMARY:2,BODY:3},ACT_STATUS:{NEW:1,BEFORE_EDIT:2,AFTER_EDIT:3,END:4},ACTION:{THROW:"throw",GAIN:"gain",RETHROW:"rethrow"},STATUS:{THROW:{UNSOLVED:1,UNCOMMENT:2,SOLVED:3},GAIN:{UNEDIT:4,EDITING:5,SUCCESS:6,FAIL:7}},REQ_URLS:{BOTTLE_CHECK_URL:"/user/ajax/bottle/throw?",BOTTLE_OPEN_URL:"/user/ajax/bottle/show?"},REPLACE:function(_,A){return _;},GET_BOTTLE_STATUS:function(_,A){switch(A){case bk.floatBottle.ACTION.THROW:switch(_){case 1:case 2:case 3:return bk.floatBottle.STATUS.THROW.UNSOLVED;case 4:case 5:return bk.floatBottle.STATUS.THROW.UNCOMMENT;case 6:case 7:case 8:case 9:return bk.floatBottle.STATUS.THROW.SOLVED;}break;case bk.floatBottle.ACTION.GAIN:switch(_){case 1:case 2:return bk.floatBottle.STATUS.GAIN.UNEDIT;case 3:case 4:case 5:return bk.floatBottle.STATUS.GAIN.EDITING;case 6:case 7:return bk.floatBottle.STATUS.GAIN.SUCCESS;case 8:case 9:return bk.floatBottle.STATUS.GAIN.FAIL;}break;}},GET_BOTTLE_CONT:function(A){var _=null;switch(parseInt(A,10)){case 1:return bk.floatBottle.cardBottle;default:return bk.floatBottle.bottle;}}});baidu.lang.inherits(bk.floatBottle.bottle,baidu.lang.Class);baidu.extend(bk.floatBottle.bottle.prototype,{isEmpty:function(){return false;},parseReply:function(_){return null;},getReplyList:function(){},check:function(){},open:function(_){var A=this;bk.usercenter.ajax.post(bk.floatBottle.REQ_URLS.BOTTLE_OPEN_URL,baidu.url.jsonToQuery({bottleId:A.id}),function(D){if(D.responseText){var B=baidu.json.parse(D.responseText),C=B.bottle,F=bk.floatBottle.tools.parseRdBottle2My(C);A.replyList=[];baidu.each(B.reply,function(_){A.replyList.push(A.parseReply(_,F));});var G=new bk.floatBottle.reply({id:0,from:F.thrower,tag:C.content,bottle:F,isOpen:true,type:0,status:F.status});A.replyList.push(G);var E={bottle:F,reply:A.replyList};A.dispatchEvent("onOpen",E);_.dispatchEvent("onBottleOpen",E);}});},getThrowData:function(){return null;},getRefuseData:function(){return null;}});})();(function(){bk.floatBottle.cardBottle=function(_){bk.floatBottle.bottle.call(this,_);this.type=bk.floatBottle.BOTTLE_TYPE.CARD;this.lemma=this.lemmas?this.lemmas[0]:_.lemma;};baidu.lang.inherits(bk.floatBottle.cardBottle,bk.floatBottle.bottle);baidu.extend(bk.floatBottle.cardBottle.prototype,{parseReply:function(_){return[];},check:function(){var A=this,_={action:"throwCheck","bottleContent[type]":this.type,"bottleContent[lemmaId]":this.lemma.lemmaId};baidu.ajax.post(bk.floatBottle.REQ_URLS.BOTTLE_CHECK_URL+"r="+Math.random(),baidu.url.jsonToQuery(_,bk.floatBottle.REPLACE),function(B){var _=baidu.json.parse(B.responseText);if(_.success){A.dispatchEvent("onCheckSuccess");}else{A.dispatchEvent("onCheckFail",{code:_.flag,detail:_.detailFlag});}});},getThrowData:function(){return{"bottleContent[reason]":encodeURIComponent(this.tag.reason),"bottleContent[content]":encodeURIComponent(this.tag.content),"bottleContent[reference]":encodeURIComponent(this.tag.reference),"bottleContent[part]":encodeURIComponent(this.tag.part)};},getRefuseData:function(){if(!this.refuse){return{};}return{content:encodeURIComponent(this.refuse.reason),reference:encodeURIComponent(this.refuse.reference)};},parseReply:function(_,B){var A=new bk.floatBottle.reply({id:_.id,isOpen:(1==_.isOpen?true:false),from:new bk.usercenter.bottleUser(_.from),to:new bk.usercenter.bottleUser(_.to),bottle:B,type:parseInt(_.type),status:parseInt(_.status),tag:_.content});return A;}});})();baidu.more.ns("bk.usercenter");(function(){bk.usercenter.user=function(_){baidu.extend(this,_);};baidu.lang.inherits(bk.usercenter.user,baidu.lang.Class);baidu.extend(bk.usercenter.user.prototype,{equalTo:function(_){return(_!=null&&_.id==this.id);},getUserIcon:function(){if(0==this.id){return"http://img.baidu.com/img/baike/logo-baike.gif";}if(0==this.avatar){return"http://img.baidu.com/img/baike/pictures/r0s1g"+this.level+".gif";}else{return _[this.avatar];}},toString:function(){return["id:",this.id,",name:",this.name,",level:",this.level];}});var _={1:"http://img.baidu.com/img/baike/encourage/user-priority-boy.gif",2:"http://img.baidu.com/img/baike/encourage/user-priority-girl.gif",3:"http://img.baidu.com/img/baike/encourage/5year-boy.png",4:"http://img.baidu.com/img/baike/encourage/5year-girl.png"};})();(function(){var _="/user/ajax/bottle/list?",D="/user/ajax/bottle/salvage?",B="/user/ajax/bottle/throw?",A="/user/ajax/bottle/editInfo?",C="/user/ajax/bottle/arbitration?";bk.usercenter.bottleUser=function(_){bk.usercenter.user.call(this,_);this.bottlesThrow=[];this.bottlesGain=[];this.maxThrowCount=_.throwCount||0;this.maxGainCount=_.gainCount||0;this.hasThrowCount=this.hasGainCount=0;};baidu.lang.inherits(bk.usercenter.bottleUser,bk.usercenter.user);baidu.extend(bk.usercenter.bottleUser.prototype,{throwBottle:function(D){var C=this;if(D.id){C.reThrow(D);return;}var _=D.lemmas[0]||D.lemma,A={r:Math.random(),action:"throwBottle","bottleContent[lemmaId]":_.lemmaId,"bottleContent[lemmaTitle]":encodeURIComponent(_.lemmaTitle),"bottleContent[subLemmaId]":_.subLemmaId,"bottleContent[subLemmaTitle]":encodeURIComponent(_.subLemmaTitle),"bottleContent[type]":D.type};baidu.extend(A,D.getThrowData());baidu.ajax.post(B,baidu.url.jsonToQuery(A,bk.floatBottle.REPLACE),function(A){if(A.responseText){var _=baidu.json.parse(A.responseText);if(_.success){C.dispatchEvent("onThrowSuccess",{actionType:bk.floatBottle.ACTION.THROW});}else{C.dispatchEvent("onThrowFail",{actionType:bk.floatBottle.ACTION.THROW,code:_.flag,detail:_.detailFlag});}}});},reThrow:function(D){var C=this,B=D.replyList[0],_={r:Math.random(),action:"throwAgain",bottleId:D.id,replyId:B.id};baidu.ajax.post(A,baidu.url.jsonToQuery(_),function(A){if(A.responseText){var _=baidu.json.parse(A.responseText);if(_.success){C.dispatchEvent("onThrowSuccess",{actionType:bk.floatBottle.ACTION.RETHROW});}else{C.dispatchEvent("onThrowFail",{actionType:bk.floatBottle.ACTION.RETHROW,code:_.flag,detail:_.detailFlag});}}});},gain:function(){var _=this;bk.usercenter.ajax.post(D+"r="+Math.random(),baidu.url.jsonToQuery({type:bk.floatBottle.BOTTLE_TYPE.CARD}),function(B){if(B.responseText){var A=baidu.json.parse(B.responseText);if(A.error){_.dispatchEvent("onGainFail",{code:A.error,flag:A.flag});}else{_.dispatchEvent("onGainSuccess",{bottle:A});}}});},refuse:function(B){var _=this,C={action:"addReply",bottleId:B.id,r:Math.random()};baidu.extend(C,B.getRefuseData());baidu.ajax.post(A,baidu.url.jsonToQuery(C,bk.floatBottle.REPLACE),function(B){if(B.responseText){var A=baidu.json.parse(B.responseText);if(A.success){_.dispatchEvent("onRefuseSuccess");}else{_.dispatchEvent("onRefuseFail",{code:A.flag,detail:A.detailFlag});}}});},ignore:function(C){var B=this,_={r:Math.random(),action:"ignoreBottle",bottleId:C.id};baidu.ajax.post(A,baidu.url.jsonToQuery(_,bk.floatBottle.REPLACE),function(A){if(A.responseText){var _=baidu.json.parse(A.responseText);if(_.success){B.dispatchEvent("onIgnoreSuccess");}else{B.dispatchEvent("onIgnoreFail");}}});},getBottles:function(A,D,C,B){var E=this;bk.usercenter.ajax.post(_,baidu.url.jsonToQuery({page:A,action:C,recordPerPage:D,r:Math.random()},bk.floatBottle.REPLACE),function(F){if(F.responseText){var _=baidu.json.parse(F.responseText),E={page:A,action:C,totalRecord:_.totalRecord,recordPerPage:D,bottles:[],recycle:_.recycle};baidu.each(_.bottles,function(_){E.bottles.push(bk.floatBottle.tools.parseRdBottle2My(_));});B&&B(E);}});},agree:function(D){var C=this,B=D.replyList[0],_={r:Math.random(),action:"addThanks",bottleId:D.id,replyId:B.id,content:B.tag.thanksVal};baidu.ajax.post(A,baidu.url.jsonToQuery(_,bk.floatBottle.REPLACE),function(A){if(A.responseText){var _=baidu.json.parse(A.responseText);if(_.success){C.dispatchEvent("onAgreeSuccess");}else{C.dispatchEvent("onAgreeFail");}}});},arbitration:function(B){var A=this,_={r:Math.random(),bottleId:B.id};baidu.ajax.post(C,baidu.url.jsonToQuery(_),function(B){if(B.responseText){var _=baidu.json.parse(B.responseText);if(_.success){A.dispatchEvent("onArbitrationSuccess");}else{A.dispatchEvent("onArbitrationFail");}}});},open:function(_){_.open(this);}});})();baidu.more.ns("bk.usercenter");(function(){bk.usercenter.message=function(_){this._timer=null;this._curReq=null;this._running=false;this.runner=null;_=_||{};this.method=_.method||bk.usercenter.message.REQ_METHOD.GET;this.timeType=_.type||bk.usercenter.message.TIME_TYPE.INTERVAL;if(bk.usercenter.message.TIME_TYPE.INTERVAL==this.timeType){this.reqDuration=_.interval||bk.usercenter.message.DEFAULT_REQ_DURATION;}this.url=_.url;this.urlParams=_.urlParams||{};this.data=_.data||{};baidu.lang.Class.call(this);return this;};baidu.lang.inherits(bk.usercenter.message,baidu.lang.Class);baidu.extend(bk.usercenter.message.prototype,{start:function(){if(this._running){this.cancel();}this._reqStart();this.dispatchEvent("onReqStart");this._running=true;if(bk.usercenter.message.TIME_TYPE.INTERVAL==this.timeType){this._timer=setInterval(baidu.fn.bind(this._reqStart,this),this.reqDuration);}},cancel:function(){this._running=false;clearTimeout(this._timer);this._curReq!=null&&this._curReq.abort();this.dispatchEvent("onReqCancel");},_reqStart:function(){baidu.extend(this.urlParams,{r:Math.random()});if(!("entry"in this.urlParams)){this.urlParams.entry=2;}var _=this.url+baidu.url.jsonToQuery(this.urlParams);this._curReq=baidu.ajax.request(_,bk.usercenter.message.GET_REQ_DATA(this.method,{onsuccess:baidu.fn.bind(this._onSuccess,this),data:this.data}));},_getTag:function(){return this.constructor;},_onSuccess:function(B){var _=B.responseText,A={message:_};if(""==_||"null"==_||/html/.test(_)){this.cancel();this.dispatchEvent("onSessionTimeout",A);if(this.runner){this.runner._processSessionTimeout();}}else{this.dispatchEvent("onDataGet",A);if(this.runner){A.tag=this._getTag();this.runner._processDataGet(A);}}}});baidu.extend(bk.usercenter.message,{TIME_TYPE:{SINGLE:1,INTERVAL:2},REQ_METHOD:{GET:"get",POST:"post"},DEFAULT_REQ_DURATION:300000,GET_REQ_DATA:function(A,B){var _={};_.onsuccess=B.onsuccess;if(A==bk.usercenter.message.REQ_METHOD.POST){_.method="post";_.data=B.data;}return _;}});})();(function(){bk.usercenter.messageRunner=function(){this.messageList=[];this._running=false;return this;};baidu.lang.inherits(bk.usercenter.messageRunner,baidu.lang.Class);baidu.extend(bk.usercenter.messageRunner.prototype,{_processDataGet:function(_){this.dispatchEvent("onDataGet",_);},_processSessionTimeout:function(){this.release();this.dispatchEvent("onSessionTimeout");},_getMessage:function(_){return this.messageList[_]||null;},_getValidMessage:function(_){return baidu.array.filter(_,function(_){if(_!=null){return true;}});},_doAction:function(A,B){var _=this._getValidMessage(A);baidu.each(_,function(_){B.call(_);});},_getList:function(_){var A=[];if(_){A.push(this._getMessage(_));}else{A=this.messageList;}return A;},stop:function(_){var A=bk.usercenter.message.prototype.cancel;this._doAction(this._getList(_),A);this._running=false;},start:function(_){var A=bk.usercenter.message.prototype.start;this._doAction(this._getList(_),A);this._running=true;},addMessage:function(_){this.messageList.push(_);_.runner=this;if(this._running){_.start();}return this;},removeMessage:function(_){var A=parseInt(_,10),B=null;if(!isNaN(A)){B=this._getMessage(A);}else{B=_;}if(B){B.cancel();for(var E=0,D=this.messageList.length;E<D;++E){var C=this.messageList[E];if(C==B){this.messageList.splice(E,1,null);}}}},release:function(){this.stop();baidu.each(this.messageList,function(_){if(_){_.cancel();_=null;}});}});})();baidu.more.ns("bk.usercenter");(function(){bk.usercenter.messageBoard=function(C){this._wrap=baidu.g(C.wrap);this._contentWrap=baidu.g(C.contentWrap);this._messages=[];this._className=C.className||"message-board";this._contentWrap.className=this._className;this.maxShowcount=C.maxCount||baidu.usercenter.messageBoard.DEFAULT_COUNT;var A=C.sortFunc,B=C.buildMsgFunc,_=function(A,_){if(_){return A.sort(_);}return A;};baidu.extend(this,{show:function(){baidu.dom.show(this._wrap);},hide:function(){baidu.dom.hide(this._wrap);},close:function(){this.clearMessages();this._wrap.parentNode.removeChild(this._wrap);},getWrapDomChindren:function(){return baidu.dom.query("."+this._className+" ul li");},clearMessages:function(){var _=this._messages;baidu.each(this.getWrapDomChindren(),function(C,A){var B=baidu.dom.getAttr(C,"click");if(B){baidu.un(C,"click",_[A].handler);}});this._contentWrap.innerHTML="";this._messages=[];},setMessages:function(F){this.clearMessages();if(baidu.lang.isArray(F)){this._messages=[].concat(F);}else{this._messages.push(F);}var G=_(this._messages,A),E=Math.min(this.maxShowcount,G.length),D=document.createElement("ul");for(var H=0;H<E;++H){if(B){var C=document.createElement("li");C.appendChild(B(this._messages[H]));D.appendChild(C);}}this._contentWrap.appendChild(D);}});};baidu.extend(bk.usercenter.messageBoard,{DEFAULT_COUNT:4});})();baidu.more.ns("bk.floatBottle");bk.floatBottle.tools=(function(){var F={1:["\u5df2\u53d1\u51fa","s5","send"],2:["\u5f85\u8bc4\u4ef7","s6","uncomment"],3:["\u5df2\u5904\u7406","s1","solve"],4:["\u5f85\u5904\u7406","s4","unedit"],5:["\u8fdb\u884c\u4e2d","s3","going"],6:["\u5df2\u5b8c\u6210","s1","success"],7:["\u5df2\u5173\u95ed","s2","fail"]};function B(D,C,B){D=baidu.g(D);var _=D.innerText||D.textContent,A=new RegExp(C);if(A.test(_)){_=_.replace(A,function(_){return'<span style="color:red" onclick="this.style.color=\'\'">'+_+"</span>";});D.innerHTML=_;B&&B(C);}}function L(B,_,C){if(B.setSelectionRange){B.setSelectionRange(_,C);}else{if(B.createTextRange){var A=B.createTextRange();A.collapse(true);A.moveStart("character",_);A.moveEnd("character",C-_);A.select();}}B.focus();}function H(E,A,C,B){E=baidu.g(E);var D=A.indexOf(C);if(-1!=D){var _=D+C.length;L(E,D,_);B&&B(C);}}function J(C,E){var B=/(\{\w+\})/g,_=C.match(B);if(!_||0==(len=_.length)){return C;}for(var G=len;G--;){var F=_[G],A=F.length-2,D=F.substr(1,A);if(!E.hasOwnProperty(D)){E[D]="";}C=C.replace(new RegExp(F,"g"),E[D]);}return C;}function I(E,K,D){var M=E.thrower,J=M.name;if(0==M.id){M.name="\u7cfb\u7edf";}var L=M.getUserIcon(),G=E.fromDate.split(" ")[0],C=bk.floatBottle.GET_BOTTLE_STATUS(parseInt(E.status),K),H=F[C],_=E.thrower,A=E.lemmas[0],I=_.equalTo(D)?"\u60a8\u53d1\u51fa\u6c42\u52a9\u74f6":"\u60a8\u6536\u5230"+_.name+"\u7684\u6c42\u52a9\u74f6",B={name:J,src:L,id:E.id,date:G,statusMsg:H[0],statusClass:H[1],openClass:(1==E.isOpen?"":"unopen"),contentStr:I,lemmaId:A.lemmaId,lemmaTitle:A.lemmaTitle+(A.subLemmaTitle?"-"+A.subLemmaTitle:"")};return B;}function C(A){var _=bk.floatBottle.GET_BOTTLE_CONT(A.type),C={id:A.id,from:new bk.usercenter.user(A.from),fromDate:A.throwDate,isOpen:A.isOpen,type:A.type,status:A.status,thrower:new bk.usercenter.user(A.user),lemmas:[{lemmaId:A.lemmaId,lemmaTitle:A.lemmaTitle,subLemmaId:A.subLemmaId,subLemmaTitle:A.subLemmaTitle,versionId:A.versionId,subVersionId:A.subVersionId}]};if(A.content){baidu.extend(C,{tag:A.content});}var B=new _(C);return B;}function D(){if(location.hash.length>0){if(history.pushState){history.pushState("",document.title,location.pathname);}else{location.hash="_";}}}function G(_){var A=baidu.event.get(_);_.stopPropagation();}function E(_){var A=[];if(_.bottle){A.push({type:1,count:_.bottle.length});}if(_.reply){A.push({type:2,count:_.reply.length});}return A;}function A(_){if(baidu.firefox){_.addEventListener("DOMMouseScroll",function(A){_.scrollTop+=A.detail>0?30:-30;A.preventDefault();},false);}else{_.onmousewheel=function(A){A=A||window.event;_.scrollTop+=A.wheelDelta>0?-30:30;A.returnValue=false;};}}function _(_,A){A=A||"#999";if(baidu.browser.ie<=8||parseFloat(baidu.browser.firefox)<4){var E=baidu.g(_),D=E.getAttribute("placeholder"),C=baidu.dom.getStyle(E,"color");function B(){var _=E.value;if(""==_||D==_){E.value=D;baidu.dom.setStyle(E,"color",A);}}baidu.on(E,"focus",function(){var _=E.value;if(""==_||_==D){E.value="";baidu.dom.setStyle(E,"color",C);}});baidu.on(E,"blur",B);B();}}function K(_,B,A){if(typeof _=="undefined"){return;}bk.usercenter.ajax.get("/user/ajax/bottle/setting?receiveMsg="+_+"&r="+Math.random(),function(C){var _=baidu.json.parse(C.responseText);if(_.success&&B){B();}else{A&&A();}});}return{highlight:B,textSelect:H,substitude:J,removeHash:D,cancelEvent:G,placeholder:_,translateMessage:E,preventScroll:A,parseMyBottle2UI:I,parseRdBottle2My:C,saveSetting:K};})();baidu.more.ns("bk.lemma");bk.lemma.bottleMessage=(function(){var L={BOTTLE:1,REPLY:2,CLOSE:3,STOP:4},N="/user/ajax/bottle/notice?",Q=3,_=0,P=null,H=null,O=false,K=bk.floatBottle.tools,G,C;function B(){var _=H;if(6===baidu.ie){_.style.setExpression("zoom",'function(ele){ele.style.top = Math.max(baidu.page.getScrollTop(), 30) +"px";}(this)');}function A(){var B=30,A=baidu.page.getScrollTop();if(A>30){B=0;}if(6!==baidu.ie){_.style.top=B+"px";}}A();baidu.on(window,"resize",A);baidu.on(window,"scroll",A);baidu.on(window,"unload",function(){baidu.un(window,"resize",A);baidu.un(window,"scroll",A);});}function D(_){H=I();B();C=new bk.usercenter.messageBoard({wrap:H,contentWrap:"btl-indicator-content",maxCount:Q,buildMsgFunc:F});G=new bk.usercenter.message({url:N,urlParams:{type:1},type:bk.usercenter.message.TIME_TYPE.INTERVAL,interval:600000});G.addEventListener("onDataGet",A);G.start();}function I(){var _=document.createElement("div");_.id="btl-msg-indicator";_.className="float-board";_.style.display="none";_.innerHTML='<div class="btl-indicator"><div id="btl-indicator-content"></div><a class="close" onclick="bk.lemma.bottleMessage.close()" href="javascript:;">\xd7</a></div>';document.body.appendChild(_);return _;}function A(A){var B=K.translateMessage(baidu.json.parse(A.message));if(0==B.length&&0==_){P=new bk.ui.enctip();P.init();O=true;}if(B.length>0){if(O){P&&P.close();O=false;}C.show();B.push({type:L.CLOSE});C.setMessages(B);}_++;}function F(B){var A=document.createElement("div"),_="";switch(B.type){case L.BOTTLE:_='<span class="dot"></span><span class="msg-content">\u6709<span style="color:red">1</span>\u4e2a\u6c42\u52a9\u74f6\u6f02\u6765\u4e86\uff0c<a href="/uc/bottle#1" target="_blank" onclick="bk.lemma.bottleMessage.close()">\u53bb\u635e\u74f6\u5b50\u5e2e\u5fd9</a></span>';break;case L.REPLY:_='<span class="dot"></span><span class="msg-content"><strong><span class="red">'+B.count+'</span></strong>\u4e2a\u6c42\u52a9\u74f6\u6709\u65b0\u52a8\u6001\uff0c<a href="/uc/bottle#2" target="_blank" onclick="bk.lemma.bottleMessage.close()">\u67e5\u770b\u6211\u7684\u74f6\u5b50</a></span>';break;case L.CLOSE:A.style.cssText="text-align:right;padding:.5em .5em 0 0;";_='<a href="javascript:;" onclick="bk.lemma.bottleMessage.stop();">\u4e0d\u518d\u63d0\u793a</a>';break;case L.STOP:_='\u8bbe\u7f6e\u6210\u529f\uff01<span style="color:#999">\u53ef\u5728\u201c\u4e2a\u4eba\u4e2d\u5fc3-\u6211\u7684\u6c42\u52a9\u74f6-\u8bbe\u7f6e\u201d\u4e2d\u91cd\u65b0\u5f00\u542f\u3002</span>';break;}A.innerHTML=_;return A;}function M(){G.cancel();C.close();}function J(){C.setMessages([{type:L.STOP}]);if("undefined"!=typeof easy.fx){var _=new easy.fx({selector:H,duration:210,animate:true,from:[["opacity",1,0]],to:[["opacity",0,0]],onStart:function(){G.cancel();return true;},onStop:function(){C.close();}});setTimeout(function(){_.start();},2000);}else{M();}}function E(){baidu.ajax.get("/user/ajax/bottle/setting?receiveMsg=0&r="+Math.random(),function(A){var _=baidu.json.parse(A.responseText);if(_.success){J();}});}return{run:D,stop:E,close:M};})();baidu=baidu||{};baidu.bottle=(function(){var _;return{closeDialog:function(){_.close();},throwBottle:function(D,_,C,B,H,A){A=A||"";if(!A&&G("polysemy-sub-lemma-desc-temp")&&"undefined"!==typeof(EditHelpConf)&&EditHelpConf.isPolysemy){A=G("polysemy-sub-lemma-desc-temp").value;}if(!H&&G("polysemy-sub-lemma-id")&&"undefined"!==typeof(EditHelpConf)&&EditHelpConf.isPolysemy){H=G("polysemy-sub-lemma-id").value;}var F=new bk.floatBottle.cardBottle({lemmas:[{lemmaId:D,lemmaTitle:_}]}),E=this;F.addEventListener("onCheckSuccess",function(F){E._doThrwoBottle(D,_,C,B,H,A);});F.addEventListener("onCheckFail",function(_){var A=["","\u6b63\u5e38","\u6765\u6e90\u8bcd\u6216\u8005\u9501\u5b9a\u8bcd","\u74f6\u5b50\u6254\u8fc7\u4e86","\u6b21\u6570\u8d85\u8fc7","\u5305\u542b\u654f\u611f\u8bcd","\u63d0\u4ea4\u9a8c\u8bc1\u5931\u8d25","\u6254\u74f6\u5b50\u5931\u8d25","\u6254\u6210\u529f","\u672c\u671f\u6c42\u52a9\u74f6\u4ec5\u5f00\u653e\u540d\u7247\u6c42\u52a9\u3002\u60a8\u5df2\u7ecf\u6709\u540d\u7247\u6743\u9650\uff0c\u5feb\u53bb\u53d1\u6325\u7279\u6743\uff0c\u635e\u74f6\u5b50\u5e2e\u52a9\u522b\u4eba\u5427\uff01"];if(_.code===2){E.showDialog("lockedlemma");}else{if(_.code===3){E.showDialog("versionconflict");}else{if(_.code===4){E.showDialog("nobottle",{nums:_.detail});}else{if(_.code===9){E.showDialog("cahedit");}else{alert(A[_.code]);}}}}});F.check();},_doThrwoBottle:function(E,A,D,C,F,B){C=C||1;_=Fe.Dialog.open("/page/throwbtl.html?lemmaId="+E+"&lemmaTitle="+encodeURIComponent(A)+"&userId="+D+"&type="+C+"&polysemy="+encodeURIComponent(B)+"&polysemyId="+(F),{title:"\u53d1\u9001\u6c42\u52a9\u74f6",width:"483px",height:"490px",buttonAcceptValue:"\u6254\u51fa\u53bb",buttonCancelValue:"\u4e0d\u6254\u4e86",buttonbar:true,buttonAccept:true,buttonCancel:true,contentType:"HTMLUrl",locked:true,onaccept:function(){if(_.getIframe()){_.getIframe().contentWindow.throwBottle();}}});_.addEventListener("onaccept",function(_){_.returnValue=false;});},showDialog:function(A,B){var _="";switch(A){case"lockedlemma":Detect.content="<p>\u6765\u6e90\u8bcd\u6216\u9501\u5b9a\u8bcd\u4e0d\u80fd\u8fdb\u884c\u6c42\u52a9\u3002</p>";_="\u4e0d\u80fd\u6c42\u52a9";break;case"versionconflict":Detect.content="<p>\u5df2\u6709\u79d1\u53cb\u5bf9\u8be5\u8bcd\u6761\u7684\u540d\u7247\u53d1\u8d77\u4e86\u6c42\u52a9\uff0c\u6c42\u52a9\u6b63\u5728\u8fdb\u884c\u4e2d\u3002\u4f11\u606f\u4e00\u4e0b\uff0c\u4e00\u4f1a\u513f\u518d\u6765\u770b\u770b\u5427\u3002</p>";_="\u53d1\u9001\u6c42\u52a9\u74f6";break;case"nobottle":Detect.content="\u6bcf\u4eba\u6bcf\u5929\u53ea\u6709"+B.nums+'\u4e2a\u74f6\u5b50\uff0c\u4eca\u5929\u7684\u74f6\u5b50\u7528\u5b8c\u5566\uff01\u4f60\u4e5f\u53ef\u4ee5\u53c2\u52a0<a href="/uc/task#1" target="_blank">\u6210\u957f\u4efb\u52a1</a>\uff0c\u52a0\u901f\u5347\u7ea7\uff0c\u81ea\u5df1\u83b7\u5f97\u6743\u9650\u6765\u7f16\u8f91\uff01';_="\u74f6\u5b50\u4e0d\u591f\u5566";break;case"cahedit":Detect.content="\u672c\u671f\u6c42\u52a9\u74f6\u4ec5\u5f00\u653e\u540d\u7247\u6c42\u52a9\u3002\u60a8\u5df2\u7ecf\u6709\u540d\u7247\u6743\u9650\uff0c\u5feb\u53bb\u53d1\u6325\u7279\u6743\uff0c\u635e\u74f6\u5b50\u5e2e\u52a9\u522b\u4eba\u5427\uff01<br/>\u6709\u6c42\u52a9\u9700\u7f16\u8f91\u65f6\uff0c\u4f1a\u6709\u5c0f\u6c14\u6ce1\u63d0\u793a\u60a8\uff0c\u4e5f\u53ef\u4ee5\u968f\u65f6\u53bb\u201c\u4e2a\u4eba\u4e2d\u5fc3-\u6211\u7684\u6c42\u52a9\u74f6\u201d\u635e\u53d6\u3002";_="\u60a8\u5df2\u6709\u540d\u7247\u6743\u9650";break;default:Detect.content="\u51fa\u9519\u4e86\uff01";_="\u51fa\u9519\u4e86\uff01";break;}Fe.Dialog.open("/page/privcheck.html",{title:_,width:"402px",height:"180px",buttonbar:true,buttonAccept:true,buttonCancel:false,contentType:"HTMLUrl",locked:true});}};})();baidu.dom.ready(function(){var A=baidu.g("lemmaid");if(!A){return;}A=A.value;if(!A){return;}var C="/user/ajax/bottle/getinfo",_="lemmaId="+A,B=function(_,B){if(!B||"null"===B||"[]"===B||/html/.test(B)){return;}var A=baidu.json.parse(B);baidu.g("tip-btl-content-mod").innerHTML=A.content.content;baidu.g("tip-btl-content-reason").innerHTML=A.content.reason;baidu.g("tip-btl-content-ref").innerHTML=A.content.reference;baidu.g("tip-btl-link").href=baidu.g("tip-btl-link").href+A.id;baidu.g("tip-btl").style.display="block";};baidu.ajax.post(C,_,B);});